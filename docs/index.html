<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
<link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600;700;800;900&display=swap" rel="stylesheet">
<title>Nordic Loft Ålesund — Concierge</title>
<style>
  :root{
    --ink:#0f1420; --muted:#6f7681;
    --glass:rgba(255,255,255,.78); --glass-bd:rgba(255,255,255,.40);
    --champ:#e8d3a4;
    --ring:0 0 0 6px rgba(94,155,231,.25);
    --shadow:0 18px 48px rgba(20,24,32,.16);
    --b1:#8db5e8; --b2:#9cc0ec; --b3:#e9f2ff;
  }
  *{box-sizing:border-box}
html,body{
  margin:0; padding:0;
  min-height:100vh;     /* allow page to grow naturally */
  overflow:auto;        /* enable scrolling */
  font-family:Montserrat,system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial;
  color:var(--ink);
  background:linear-gradient(180deg,var(--b1) 0%, var(--b2) 22%, var(--b3) 56%, #ffffff 100%);
}

  /* canvas */
  .wrap{max-width:1100px;margin:12px auto;padding:0 10px;height:3176px;}
  .panel{
    height:100%; display:flex; flex-direction:column;
    background:var(--glass); border:1px solid var(--glass-bd);
    border-radius:18px; box-shadow:var(--shadow);
    backdrop-filter:blur(16px) saturate(120%); -webkit-backdrop-filter:blur(16px) saturate(120%);
    overflow:hidden;
  }

  /* header */
  header{display:flex;align-items:center;justify-content:space-between;gap:10px;padding:10px 12px 8px}
  .brand{display:flex;align-items:center;gap:10px}
  .dot{width:10px;height:10px;border-radius:50%;background:var(--champ);box-shadow:0 0 0 6px rgba(217,190,138,.22)}
  h1{margin:0;font-size:20px;font-weight:900}
  .tag{font-size:12px;color:var(--muted);font-weight:600}
  .links{display:flex;gap:8px;flex-wrap:wrap}
  .pill{padding:7px 12px;border-radius:999px;background:#fff;border:1px solid #dfe9f9;color:#1b2b48;font-weight:800;text-decoration:none;box-shadow:0 0 0 3px rgba(90,143,205,.18)}
  .pill:hover{box-shadow:0 0 0 5px rgba(90,143,205,.30)}

  /* main 2-column */
  .grid{display:grid;grid-template-columns:1.45fr .55fr;gap:12px;padding:0 12px 12px; height:100%;}
  @media (max-width:900px){ .grid{grid-template-columns:1fr} }

  /* left column stack */
  .left{display:flex;flex-direction:column;gap:10px; overflow:hidden;}
  .card{background:#fff;border:1px solid #efe4cf;border-radius:14px;overflow:hidden;display:flex;flex-direction:column}
  .hero{padding:10px 12px;border-bottom:1px solid #efe4cf;background:linear-gradient(180deg,#fff,#fbf7f1)}
  .hero h2{margin:0;font-size:14px;font-weight:900}
  .hero p{margin:4px 0 0;color:var(--muted);font-size:12px}
  .pad{padding:10px 12px}

  /* groceries */
  .chips{display:grid;grid-template-columns:repeat(4,1fr);gap:8px}
  @media(max-width:900px){.chips{grid-template-columns:repeat(3,1fr)}}
  .chip{position:relative;text-align:center;font-weight:800;padding:9px 6px;border-radius:10px;background:#fbfaf8;border:1px solid #e9e2d6;cursor:pointer;transition:.15s}
  .chip:hover{box-shadow:0 0 0 3px rgba(94,155,231,.18)}
  .chip.active{background:#fff7e6;border-color:#e3d2ae;box-shadow:var(--ring)}
  .custom-row{display:flex;gap:6px;margin-top:6px}
  .custom-row input{flex:1}

  textarea,input[type="text"],input[type="email"],input[type="tel"],input[type="date"]{
    width:100%;padding:9px;border-radius:10px;border:1px solid #e6ddcc;background:#fff;font-size:14px
  }

  /* products */
  .products{display:grid;grid-template-columns:repeat(3,1fr);gap:10px}
  @media(max-width:900px){.products{grid-template-columns:repeat(2,1fr)}}
  .p{background:#fff;border:1px solid #eee3cf;border-radius:12px;overflow:hidden;transition:.2s;display:flex;flex-direction:column;min-height:360px}
  .p:hover{transform:translateY(-2px);box-shadow:0 8px 20px rgba(0,0,0,.10)}
  .imgWrap{width:100%;height:220px;background:#fff;display:flex;align-items:center;justify-content:center}
  .p img{max-width:100%;max-height:100%;object-fit:contain}
  .meta{padding:8px}
  .meta .name{font-weight:800;font-size:12.5px}
  .meta .desc{color:var(--muted);font-size:11.5px;margin-top:2px;min-height:24px}

  .price-add{margin-top:auto;display:flex;align-items:center;justify-content:space-between;padding:8px;border-top:1px solid #f1eadc;gap:8px}
  .price{font-weight:900}
  .stepper{display:flex;align-items:center;gap:5px}
  .stepper button{width:26px;height:26px;border-radius:8px;border:1px solid #e6ddcc;background:#fff;font-weight:900;cursor:pointer}
  .stepper input{width:38px;text-align:center;padding:6px;border-radius:8px;border:1px solid #e6ddcc;background:#fff}
  .btn{padding:8px 11px;border-radius:10px;border:1px solid #e7e0d2;background:#fff;font-weight:800;cursor:pointer;white-space:nowrap}
  .btn.gold{background:linear-gradient(180deg,#fff3d4,#ebd09b);border-color:#e3d2ae}
  .btn.primary{background:linear-gradient(180deg,#7bb9ff,#5a8fcd);border-color:#5a8fcd;color:#fff;box-shadow:0 10px 22px rgba(90,143,205,.28)}
  .btn:hover{filter:brightness(1.05)} .btn:active{transform:translateY(1px)}
  .p.added{box-shadow:var(--ring),0 8px 20px rgba(0,0,0,.12)}

  /* mobile: keep Add visible (stack below) */
  @media(max-width:600px){
    .price-add{flex-direction:column;align-items:stretch}
    .price{align-self:flex-start}
    .stepper{order:1}
    .price-add .btn[data-action="add-product"]{order:2;width:100%}
  }

  /* activities */
  .actgrid{display:grid;grid-template-columns:repeat(2,1fr);gap:10px}
  @media(max-width:900px){.actgrid{grid-template-columns:1fr}}
  .act{background:#fff;border:1px solid #eee3cf;border-radius:12px;padding:8px;display:flex;flex-direction:column}
  .act h3{margin:0 0 4px;font-size:14px;font-weight:900}
  .act p{margin:0;color:var(--muted);font-size:11.8px;min-height:30px}
  .imgrow{display:grid;grid-template-columns:repeat(3,1fr);gap:6px;margin:6px 0}
  .ph{width:100%;height:90px;background:#fff;display:flex;align-items:center;justify-content:center;border-radius:8px}
  .ph img{max-width:100%;max-height:100%;object-fit:contain;border-radius:6px}
  .act .actions{margin-top:auto;display:flex;gap:6px}

  /* order column */
  aside{display:flex;flex-direction:column;overflow:hidden}
  .order{background:#fff;border:1px solid #efe4cf;border-radius:14px;display:flex;flex-direction:column;height:100%}
  .order .head{padding:10px 12px;font-weight:900;border-bottom:1px solid #efe4cf}
  .order .items{padding:8px 12px;display:flex;flex-direction:column;gap:6px;min-height:120px;overflow:hidden}
  .rowItem{display:flex;align-items:center;justify-content:space-between;padding:6px 8px;background:#fff;border:1px solid #efe3cb;border-radius:10px}
  .rowItem .l{display:flex;gap:6px;align-items:center;flex-wrap:wrap}
  .est{font-size:10.5px;color:#6a5330;background:#fff0d0;border:1px solid #ecd6a4;padding:2px 6px;border-radius:999px;font-weight:800}
  .order .total{padding:8px 12px;font-weight:900;border-top:1px solid #efe4cf;display:flex;justify-content:space-between}
  .order .form{padding:10px 12px;display:grid;gap:6px}

  /* learn modal */
  .modal{position:fixed;inset:0;background:rgba(9,14,22,.35);backdrop-filter:blur(8px);-webkit-backdrop-filter:blur(8px);display:none;align-items:center;justify-content:center;padding:16px;z-index:50}
  .modal.open{display:flex;animation:fade .18s ease-out}
  @keyframes fade{from{opacity:0}to{opacity:1}}
  .sheet{background:#fff;border:1px solid #eee3cf;border-radius:14px;box-shadow:var(--shadow);max-width:720px;width:100%;max-height:80vh;display:flex;flex-direction:column}
  .sheet .hd{padding:10px 12px;font-weight:900;border-bottom:1px solid #efe4cf}
  .sheet .bd{padding:12px;overflow:auto}
  .sheet .ft{padding:10px 12px;border-top:1px solid #efe4cf;display:flex;gap:8px;justify-content:flex-end}

  /* confirmation overlay */
  .confirm{position:fixed;inset:0;display:none;align-items:center;justify-content:center;background:rgba(255,255,255,.35);backdrop-filter:blur(10px);-webkit-backdrop-filter:blur(10px);z-index:60}
  .confirm.show{display:flex}
  .confirm .box{
    background:rgba(255,255,255,.85);
    border:1px solid #e8edf7; border-radius:16px;
    padding:20px; box-shadow:0 22px 60px rgba(0,0,0,.18);
    text-align:center; max-width:460px
  }
  .confirm .box h3{margin:0 0 6px;font-size:18px}
  .confirm .box p{margin:0;color:#5d6a78}
</style>
</head>
<body>
  <div class="wrap">
    <div class="panel">
      <header>
        <div class="brand">
          <div class="dot"></div>
          <div>
            <h1>Nordic Loft Ålesund — Concierge</h1>
            <div class="tag">Request groceries, add-ons & experiences — pay after confirmation</div>
          </div>
        </div>
        <div class="links">
          <a class="pill" href="https://docs.google.com/document/d/12GjZr3Lu2dz23FNhq0lyMkD6iD_7Wx3burXyg3A5o2g/edit?tab=t.0#heading=h.erb8cyn8svqx" target="_blank" rel="noopener">Local Guide</a>
          <a class="pill" href="https://docs.google.com/document/d/1438-pOjPXDA6WhvLcfWRjl4x0Id2-jwTWMYlVJ1PoEo/edit?usp=sharing" target="_blank" rel="noopener">Check-In</a>
        </div>
      </header>

      <div class="grid">
        <!-- LEFT -->
        <div class="left">
          <!-- Groceries -->
          <section class="card">
            <div class="hero"><h2>Groceries & Shopping Service</h2><p>Tap to add. Groceries are <strong>Request Quote</strong> (priced after shopping).</p></div>
            <div class="pad">
              <div class="chips" id="groceryChips">
                <div class="chip" data-id="gro-milk" data-name="Grocery: Milk">Milk</div>
                <div class="chip" data-id="gro-oat" data-name="Grocery: Oat Milk">Oat Milk</div>
                <div class="chip" data-id="gro-eggs" data-name="Grocery: Eggs (12)">Eggs</div>
                <div class="chip" data-id="gro-bread" data-name="Grocery: Fresh Bread">Fresh Bread</div>
                <div class="chip" data-id="gro-fruit" data-name="Grocery: Seasonal Fruit">Fruit</div>
                <div class="chip" data-id="gro-spark" data-name="Grocery: Sparkling Water (1.5L)">Sparkling Water</div>
                <div class="chip" data-id="gro-snacks" data-name="Grocery: Snacks & Chocolates">Snacks</div>
                <div class="chip" data-id="gro-flowers" data-name="Grocery: Flowers">Flowers</div>
              </div>
              <div style="margin-top:6px;color:var(--muted);font-size:12px">Tap again to remove. You can also add a custom item:</div>
              <div class="custom-row">
                <input id="customGroceryName" type="text" placeholder="e.g., Gluten-free bread (2), Oatly Barista x2">
                <button class="btn gold" id="addCustomGrocery" type="button">Add custom</button>
              </div>
              <textarea id="shoppingText" rows="2" placeholder="Optional: full shopping list / brands / quantities…"></textarea>
            </div>
          </section>

          <!-- Featured Add-Ons -->
          <section class="card">
            <div class="hero"><h2>Featured Add-Ons</h2><p>These are the products you’ll find in the loft — feel free to purchase what you see.</p></div>
            <div class="pad">
              <div class="products" id="products">
                <!-- 1 Wine -->
                <div class="p" data-id="wine-house-red" data-price="349" data-name="House Red Wine – Malbec (bottle)">
                  <div class="imgWrap"><img src="https://storage.googleapis.com/msgsndr/ZOaFJ8FLtFptFJMy2ZSH/media/68f8d6284ab728e809922cc0.png" alt="Malbec"></div>
                  <div class="meta"><div class="name">House Red Wine – Malbec (bottle)</div><div class="desc">A smooth, food-friendly Malbec.</div></div>
                  <div class="price-add">
                    <div class="price">kr 349</div>
                    <div class="stepper"><button data-step="-1">−</button><input type="number" value="0" min="0"><button data-step="1">+</button></div>
                    <button class="btn gold" data-action="add-product">Add</button>
                  </div>
                </div>
                <!-- 2 Glass -->
                <div class="p" data-id="norsk-glass" data-price="299" data-name="Norwegian “Norge” Glass (each)">
                  <div class="imgWrap"><img src="https://storage.googleapis.com/msgsndr/ZOaFJ8FLtFptFJMy2ZSH/media/68f8d5b64ab72867ed9222eb.jpeg" alt="Norge glass"></div>
                  <div class="meta"><div class="name">Norwegian “Norge” Glass (each)</div><div class="desc">Elegant engraved tumbler.</div></div>
                  <div class="price-add">
                    <div class="price">kr 299</div>
                    <div class="stepper"><button data-step="-1">−</button><input type="number" value="0" min="0"><button data-step="1">+</button></div>
                    <button class="btn gold" data-action="add-product">Add</button>
                  </div>
                </div>
                <!-- 3 Talking Hearts -->
                <div class="p" data-id="talking-hearts" data-price="299" data-name="Talking Hearts — Couples (200 questions)">
                  <div class="imgWrap"><img src="https://storage.googleapis.com/msgsndr/ZOaFJ8FLtFptFJMy2ZSH/media/68f8d5bcc9994e8e9cc930df.png" alt="Talking Hearts"></div>
                  <div class="meta"><div class="name">Talking Hearts — Couples (200 questions)</div><div class="desc">Deep and playful prompts.</div></div>
                  <div class="price-add">
                    <div class="price">kr 299</div>
                    <div class="stepper"><button data-step="-1">−</button><input type="number" value="0" min="0"><button data-step="1">+</button></div>
                    <button class="btn gold" data-action="add-product">Add</button>
                  </div>
                </div>
                <!-- 4 Know Me 50 -->
                <div class="p" data-id="know-me-50" data-price="199" data-name="How Well Do You Know Me? (50 questions)">
                  <div class="imgWrap"><img src="https://storage.googleapis.com/msgsndr/ZOaFJ8FLtFptFJMy2ZSH/media/68f8d5bd865897e50df7adca.png" alt="Know Me"></div>
                  <div class="meta"><div class="name">How Well Do You Know Me? (50 questions)</div><div class="desc">Quick after-dinner game.</div></div>
                  <div class="price-add">
                    <div class="price">kr 199</div>
                    <div class="stepper"><button data-step="-1">−</button><input type="number" value="0" min="0"><button data-step="1">+</button></div>
                    <button class="btn gold" data-action="add-product">Add</button>
                  </div>
                </div>
                <!-- 5 Questions for Humans -->
                <div class="p" data-id="qfh" data-price="249" data-name="Questions for Humans — Couples">
                  <div class="imgWrap"><img src="https://storage.googleapis.com/msgsndr/ZOaFJ8FLtFptFJMy2ZSH/media/68f8d5bc691ecd36e165f07a.png" alt="Questions for Humans"></div>
                  <div class="meta"><div class="name">Questions for Humans — Couples</div><div class="desc">Light, funny prompts.</div></div>
                  <div class="price-add">
                    <div class="price">kr 249</div>
                    <div class="stepper"><button data-step="-1">−</button><input type="number" value="0" min="0"><button data-step="1">+</button></div>
                    <button class="btn gold" data-action="add-product">Add</button>
                  </div>
                </div>
                <!-- 6 Date Night -->
                <div class="p" data-id="date-night" data-price="349" data-name="Date Night Adventure — 40 Scratch-Offs">
                  <div class="imgWrap"><img src="https://storage.googleapis.com/msgsndr/ZOaFJ8FLtFptFJMy2ZSH/media/68f8d5bc691ecd7d2f65f079.png" alt="Date Night Adventure"></div>
                  <div class="meta"><div class="name">Date Night Adventure — 40 Scratch-Offs</div><div class="desc">Scratch, reveal, and go!</div></div>
                  <div class="price-add">
                    <div class="price">kr 349</div>
                    <div class="stepper"><button data-step="-1">−</button><input type="number" value="0" min="0"><button data-step="1">+</button></div>
                    <button class="btn gold" data-action="add-product">Add</button>
                  </div>
                </div>
              </div>
            </div>
          </section>

          <!-- Activities -->
          <section class="card">
            <div class="hero"><h2>Activities & Arrangements</h2><p>Tap “Learn more”, then “Add” to request — we’ll confirm availability & pricing.</p></div>
            <div class="pad">
              <div class="actgrid" id="activityGrid">
                <!-- VIP Photo Shoot with Ira -->
                <div class="act" data-id="act-ira" data-name="VIP Photo Shoot with Ira">
                  <h3>VIP Photo Shoot with Ira</h3>
                  <p>Private photo experience with <strong>Ira</strong>, a talented Ukrainian photographer with warm, cinematic style.</p>
                  <div class="imgrow">
                    <div class="ph"><img src="https://storage.googleapis.com/msgsndr/ZOaFJ8FLtFptFJMy2ZSH/media/68f9011302a7ea2ed2ffc83f.jpeg" alt=""></div>
                    <div class="ph"><img src="https://storage.googleapis.com/msgsndr/ZOaFJ8FLtFptFJMy2ZSH/media/68f901134ab728b08f9a0a93.jpeg" alt=""></div>
                    <div class="ph"><img src="https://storage.googleapis.com/msgsndr/ZOaFJ8FLtFptFJMy2ZSH/media/68f9011342c58c012d355c2b.jpeg" alt=""></div>
                  </div>
                  <div class="actions">
                    <button class="btn" data-learn="ira">Learn more</button>
                    <button class="btn gold" data-action="add-activity">Add</button>
                  </div>
                </div>
                <!-- Fishing with Simon -->
                <div class="act" data-id="act-simon" data-name="Fishing with Simon (local fisher)">
                  <h3>Fishing with Simon (local fisher)</h3>
                  <p>Go with <strong>Simon</strong> for authentic fjord fishing. Spot seals, explore islands, get dropped at secret places, take home prepared fish.</p>
                  <div class="imgrow">
                    <div class="ph"><img src="https://storage.googleapis.com/msgsndr/ZOaFJ8FLtFptFJMy2ZSH/media/68f8ff2bad50b295805908f2.jpeg" alt=""></div>
                    <div class="ph"><img src="https://storage.googleapis.com/msgsndr/ZOaFJ8FLtFptFJMy2ZSH/media/68f8ff2b691ecdb41b6d0430.jpeg" alt=""></div>
                    <div class="ph"><img src="https://storage.googleapis.com/msgsndr/ZOaFJ8FLtFptFJMy2ZSH/media/68f8ff2b5da419257a2f5a5c.jpeg" alt=""></div>
                  </div>
                  <div class="actions">
                    <button class="btn" data-learn="simon">Learn more</button>
                    <button class="btn gold" data-action="add-activity">Add</button>
                  </div>
                </div>
              </div>

              <div class="pad" style="padding:6px 0 0">
                <label>Special notes or timing</label>
                <textarea id="activityText" rows="2" placeholder="Preferred time, pickup, celebration, etc."></textarea>
              </div>
            </div>
          </section>

          <div class="pad" style="text-align:center;color:#5f676f;font-size:11.5px;font-weight:700;">Payments arranged after confirmation.</div>
        </div>

        <!-- RIGHT -->
        <aside>
          <div class="order">
            <div class="head">Your Order</div>
            <div id="cartItems" class="items"></div>
            <div id="emptyNote" class="pad" style="color:var(--muted);font-size:12px">Selected items will appear here.</div>
            <div class="total"><span>Total</span><span id="grand">kr 0</span></div>
            <div class="form">
              <input id="guestName" type="text" placeholder="Your name">
              <input id="email" type="email" placeholder="Email">
              <input id="phone" type="tel" placeholder="Phone / WhatsApp">
              <input id="arrivalDate" type="date" placeholder="Arrival date">
              <input id="room" type="text" value="Nordic Loft Ålesund" placeholder="Apartment">
              <textarea id="notes" rows="2" placeholder="Delivery timing, allergies, anything else…"></textarea>
              <button id="confirmSend" class="btn primary" type="button">Confirm & Send</button>
            </div>
          </div>
        </aside>
      </div>
    </div>
  </div>

  <!-- Learn More Modal -->
  <div id="learnModal" class="modal" aria-hidden="true">
    <div class="sheet">
      <div class="hd" id="learnTitle">Experience</div>
      <div class="bd" id="learnBody"></div>
      <div class="ft"><button class="btn" onclick="toggleLearn(false)">Close</button></div>
    </div>
  </div>

  <!-- Centered Confirmation -->
  <div id="confirmOverlay" class="confirm" aria-hidden="true">
    <div class="box">
      <h3>✅ Order sent!</h3>
      <p>We’ve received your request. We’ll confirm availability and payment shortly.</p>
      <div style="margin-top:12px"><button class="btn primary" onclick="closeConfirm()">Close</button></div>
    </div>
  </div>

<script>
(() => {
  // --- CONFIG
  const WEBHOOK =
    "https://services.leadconnectorhq.com/hooks/ZOaFJ8FLtFptFJMy2ZSH/webhook-trigger/f540af18-28fb-4fdc-82cc-1a3a114d4142";

  // --- DOM (exact IDs in your HTML)
  const els = {
    cartList: document.getElementById("cartItems"),
    emptyNote: document.getElementById("emptyNote"),
    total: document.getElementById("grand"),

    // forms
    guestName: document.getElementById("guestName"),
    email: document.getElementById("email"),
    phone: document.getElementById("phone"),
    arrival: document.getElementById("arrivalDate"),
    room: document.getElementById("room"),
    notes: document.getElementById("notes"),
    shoppingText: document.getElementById("shoppingText"),
    activityText: document.getElementById("activityText"),
    sendBtn: document.getElementById("confirmSend"),

    // sections
    productCards: document.querySelectorAll(".p"),
    groceryChips: document.querySelectorAll("#groceryChips .chip"),
    activityAddBtns: document.querySelectorAll('[data-action="add-activity"]'),
    learnBtns: document.querySelectorAll("[data-learn]"),

    // overlays
    learnModal: document.getElementById("learnModal"),
    learnTitle: document.getElementById("learnTitle"),
    learnBody: document.getElementById("learnBody"),
    confirmOverlay: document.getElementById("confirmOverlay"),
  };

  // --- CART STATE
  // cartKey -> { name, qty, price }
  const cart = Object.create(null);

  function formatKr(n) {
    return "kr " + (n || 0);
  }

  function renderCart() {
    els.cartList.innerHTML = "";
    let total = 0;

    const items = Object.values(cart);
    if (items.length === 0) {
      els.emptyNote.style.display = "";
    } else {
      els.emptyNote.style.display = "none";
    }

    items.forEach((it) => {
      const row = document.createElement("div");
      row.className = "rowItem";
      row.innerHTML = `
        <div class="l"><span>${it.name}</span><span>×${it.qty}</span>${
        it.price > 0 ? "" : '<span class="est">Request&nbsp;Quote</span>'
      }</div>
        <div class="r"><b>${it.price > 0 ? formatKr(it.price * it.qty) : ""}</b></div>
      `;
      els.cartList.appendChild(row);
      total += (it.price || 0) * it.qty;
    });

    els.total.textContent = formatKr(total);
  }

  function addItem(key, name, qty, price) {
    if (!qty || qty < 1) return;
    if (!cart[key]) cart[key] = { name, qty: 0, price: price || 0 };
    cart[key].qty += qty;
    renderCart();
  }

  function toggleRequest(key, name, activeEl, activeClass = "active") {
    if (cart[key]) {
      delete cart[key];
      activeEl && activeEl.classList.remove(activeClass);
    } else {
      cart[key] = { name: name + " (Request Quote)", qty: 1, price: 0 };
      activeEl && activeEl.classList.add(activeClass);
    }
    renderCart();
  }

  // --- PRODUCTS (cards with data-name / data-price)
  els.productCards.forEach((card) => {
    const key = card.dataset.id || card.dataset.name;
    const name = card.dataset.name?.trim() || "Item";
    const price = parseInt(card.dataset.price || "0", 10);

    const qtyInput = card.querySelector('input[type="number"]');
    const addBtn = card.querySelector('[data-action="add-product"]');

    // stepper
    card.querySelectorAll("[data-step]").forEach((btn) => {
      btn.addEventListener("click", () => {
        const step = parseInt(btn.dataset.step || "0", 10);
        let v = parseInt(qtyInput.value || "0", 10);
        v = Math.max(0, v + step);
        qtyInput.value = v;
      });
    });

    // add
    addBtn?.addEventListener("click", () => {
      const qty = parseInt(qtyInput.value || "0", 10);
      addItem(key, name, qty, price);
      qtyInput.value = 0;
      // subtle glow ring to confirm
      card.classList.add("added");
      setTimeout(() => card.classList.remove("added"), 600);
    });
  });

  // --- GROCERIES (chips)
  els.groceryChips.forEach((chip) => {
    chip.addEventListener("click", () => {
      const key = chip.dataset.id;
      const label = chip.dataset.name || chip.textContent.trim();
      toggleRequest(key, label, chip, "active");
    });
  });

  // --- ACTIVITIES (Add buttons only)
  els.activityAddBtns.forEach((btn) => {
    btn.addEventListener("click", () => {
      const card = btn.closest(".act");
      if (!card) return;
      const key = card.dataset.id || card.dataset.name;
      const name = card.dataset.name || "Experience";
      // toggle like groceries (Request Quote)
      if (cart[key]) {
        delete cart[key];
        card.style.boxShadow = "";
      } else {
        cart[key] = { name: name + " (Request Quote)", qty: 1, price: 0 };
        card.style.boxShadow = "0 0 0 6px rgba(94,155,231,.25)";
      }
      renderCart();
    });
  });

  // --- LEARN MORE (modal)
  const learnCopy = {
    ira: {
      title: "VIP Photo Shoot with Ira",
      body:
        `<p>Private session with <b>Ira</b>, a talented Ukrainian photographer known for a warm, cinematic style.</p>
         <ul>
           <li>Flexible locations in Ålesund</li>
           <li>Optional styling & guidance</li>
           <li>Edited photos delivered after the shoot</li>
         </ul>`,
    },
    simon: {
      title: "Fishing with Simon (local fisher)",
      body:
        `<p>Head out with <b>Simon</b> for authentic fjord fishing. Spot seals, explore islands, get dropped at spectacular places, and take home prepared fish.</p>
         <ul>
           <li>Great for couples, families & small groups</li>
           <li>Weather-safe scheduling</li>
           <li>Custom routes by request</li>
         </ul>`,
    },
  };

  function toggleLearn(open, key) {
    if (!open) {
      els.learnModal.classList.remove("open");
      return;
    }
    const data = learnCopy[key];
    if (data) {
      els.learnTitle.textContent = data.title;
      els.learnBody.innerHTML = data.body;
    } else {
      els.learnTitle.textContent = "Experience";
      els.learnBody.textContent = "";
    }
    els.learnModal.classList.add("open");
  }
  window.toggleLearn = toggleLearn; // keep global for Close button

  els.learnBtns.forEach((b) =>
    b.addEventListener("click", () => toggleLearn(true, b.dataset.learn))
  );
  els.learnModal.addEventListener("click", (e) => {
    if (e.target === els.learnModal) toggleLearn(false);
  });

  // --- CONFIRM & SEND
  function summaryText(items) {
    return items
      .map((i) => `• ${i.name} x${i.qty}${i.price ? ` — kr ${i.qty * i.price}` : ""}`)
      .join("\n");
  }

  async function sendOrder() {
    const items = Object.values(cart);
    const payload = {
      name: els.guestName?.value || "",
      email: els.email?.value || "",
      phone: els.phone?.value || "",
      arrival_date: els.arrival?.value || "",
      apartment: els.room?.value || "",
      notes: els.notes?.value || "",
      shopping_list_freeform: els.shoppingText?.value || "",
      activity_notes: els.activityText?.value || "",
      items,
      total_kr: items.reduce((s, i) => s + (i.price || 0) * i.qty, 0),
      email_summary:
        `Order for Nordic Loft Ålesund\n\n` +
        summaryText(items) +
        `\n\nTotal: ${formatKr(
          items.reduce((s, i) => s + (i.price || 0) * i.qty, 0)
        )}\nArrival: ${els.arrival?.value || "-"}\nPhone: ${els.phone?.value || "-"}\nNotes: ${
          els.notes?.value || "-"
        }\nShopping notes: ${els.shoppingText?.value || "-"}\nActivity notes: ${
          els.activityText?.value || "-"
        }`,
    };

    try {
      await fetch(WEBHOOK, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(payload),
      });
      // Show confirmation
      els.confirmOverlay.classList.add("show");
      setTimeout(() => els.confirmOverlay.classList.remove("show"), 4000);

      // Reset state
      Object.keys(cart).forEach((k) => delete cart[k]);
      document.querySelectorAll(".chip.active").forEach((c) => c.classList.remove("active"));
      document.querySelectorAll(".p input[type='number']").forEach((i) => (i.value = 0));
      document.querySelectorAll(".act").forEach((a) => (a.style.boxShadow = ""));
      renderCart();
    } catch (e) {
      console.error("Webhook error", e);
      alert("Could not send right now. Please try again.");
    }
  }

  els.sendBtn?.addEventListener("click", sendOrder);

  // Close confirmation (button uses onclick="closeConfirm()")
  window.closeConfirm = () => els.confirmOverlay.classList.remove("show");

  // First paint
  renderCart();
})();
</script>
