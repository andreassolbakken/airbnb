<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
<link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600;700;800;900&display=swap" rel="stylesheet">
<title>Nordic Loft Ålesund — Concierge</title>
<style>
  :root{
    --ink:#121418; --muted:#6f7681;
    --glass:rgba(255,255,255,.78); --glass-bd:rgba(255,255,255,.38);
    --sand:#e9e2d6; --champ:#d9be8a;
    --ring:0 0 0 3px rgba(94,155,231,.35); --shadow:0 14px 36px rgba(20,24,32,.14);
    --blue1:#8db5e8; --blue2:#9cc0ec; --blue3:#e9f2ff;
  }
  *{box-sizing:border-box} html,body{margin:0}
  body{
    font-family:Montserrat,system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial;
    color:var(--ink);
    background:linear-gradient(180deg,var(--blue1) 0%, var(--blue2) 22%, var(--blue3) 54%, #ffffff 100%);
    overflow:visible; /* no internal scrollbars */
  }
  .wrap{max-width:1100px;margin:14px auto;padding:0 10px}
  .panel{
    background:var(--glass);
    border:1px solid var(--glass-bd);
    border-radius:18px; box-shadow:var(--shadow);
    backdrop-filter:blur(16px) saturate(120%); -webkit-backdrop-filter:blur(16px) saturate(120%);
    padding:12px;
  }
  header{display:flex;align-items:center;justify-content:space-between;gap:10px;margin-bottom:10px;flex-wrap:wrap}
  .brand{display:flex;align-items:center;gap:8px}
  .logo-dot{width:10px;height:10px;border-radius:50%;background:var(--champ);box-shadow:0 0 0 6px rgba(217,190,138,.22)}
  h1{margin:0;font-size:20px;font-weight:900}
  .tagline{font-size:12px;color:var(--muted);font-weight:600}
  .links{display:flex;gap:8px;flex-wrap:wrap}
  .pill{padding:7px 12px;border-radius:999px;background:#fff;border:1px solid #dfe9f9;color:#1b2b48;font-weight:800;text-decoration:none;box-shadow:0 0 0 3px rgba(90,143,205,.18)}
  .pill:hover{box-shadow:0 0 0 5px rgba(90,143,205,.30)}

  .grid{display:grid;grid-template-columns:1.45fr .55fr;gap:12px}
  @media (max-width:900px){ .grid{grid-template-columns:1fr} }

  .card{background:#fff;border:1px solid #efe4cf;border-radius:14px;overflow:hidden}
  .hero{padding:10px 12px;border-bottom:1px solid #efe4cf;background:linear-gradient(180deg,#fff,#fbf7f1)}
  .hero h2{margin:0;font-size:14px;font-weight:900}
  .hero p{margin:4px 0 0;color:var(--muted);font-size:12px}
  .pad{padding:10px 12px}

  textarea,input[type="text"],input[type="email"],input[type="tel"],input[type="date"]{
    width:100%;padding:9px;border-radius:10px;border:1px solid #e6ddcc;background:#fff;font-size:14px
  }

  /* Groceries chips */
  .chips{display:grid;grid-template-columns:repeat(4,1fr);gap:8px}
  @media(max-width:900px){.chips{grid-template-columns:repeat(3,1fr)}}
  .chip{position:relative;text-align:center;font-weight:800;padding:9px 6px;border-radius:10px;background:#fbfaf8;border:1px solid #e9e2d6;cursor:pointer;transition:.15s}
  .chip:hover{box-shadow:var(--ring)}
  .chip.active{background:#fff7e6;border-color:#e3d2ae;box-shadow:0 0 0 6px rgba(217,190,138,.28)}
  .chip .badge{position:absolute;top:5px;right:5px;background:#121418;color:#fff;font-size:10px;border-radius:999px;padding:1px 6px;display:none}
  .chip.active .badge{display:inline-block}
  .custom-row{display:flex;gap:6px;margin-top:6px}
  .custom-row input{flex:1}

  /* Products grid */
  .products{display:grid;grid-template-columns:repeat(3,1fr);gap:10px}
  @media(max-width:900px){.products{grid-template-columns:repeat(2,1fr)}}
  .p{background:#fff;border:1px solid #eee3cf;border-radius:12px;overflow:hidden;transition:.2s;display:flex;flex-direction:column;min-height:340px}
  .p:hover{transform:translateY(-2px);box-shadow:0 8px 20px rgba(0,0,0,.10)}
  .p.added{box-shadow:0 0 0 6px rgba(94,155,231,.28), 0 8px 20px rgba(0,0,0,.12)}
  .imgWrap{width:100%;height:200px;background:#fff;display:flex;align-items:center;justify-content:center}
  .p img{max-width:100%;max-height:100%;object-fit:contain}
  .meta{padding:8px}
  .meta .name{font-weight:800;font-size:12.5px}
  .meta .desc{color:var(--muted);font-size:11.5px;margin-top:2px;min-height:24px}
  .price-add{margin-top:auto;display:flex;align-items:center;justify-content:space-between;padding:8px;border-top:1px solid #f1eadc}
  .price{font-weight:900}
  .stepper{display:flex;align-items:center;gap:5px}
  .stepper button{width:26px;height:26px;border-radius:8px;border:1px solid #e6ddcc;background:#fff;font-weight:900;cursor:pointer}
  .stepper input{width:38px;text-align:center;padding:6px;border-radius:8px;border:1px solid #e6ddcc;background:#fff}
  .btn{padding:8px 11px;border-radius:10px;border:1px solid #e7e0d2;background:#fff;font-weight:800;cursor:pointer;white-space:nowrap}
  .btn.gold{background:linear-gradient(180deg,#fff3d4,#ebd09b);border-color:#e3d2ae}
  .btn.primary{background:linear-gradient(180deg,#7bb9ff,#5a8fcd);border-color:#5a8fcd;color:#fff;box-shadow:0 10px 22px rgba(90,143,205,.28)}
  .btn:hover{filter:brightness(1.05)} .btn:active{transform:translateY(1px)}

  /* Activities */
  .actgrid{display:grid;grid-template-columns:repeat(2,1fr);gap:10px}
  @media(max-width:900px){.actgrid{grid-template-columns:1fr}}
  .act{background:#fff;border:1px solid #eee3cf;border-radius:12px;padding:8px;display:flex;flex-direction:column}
  .act h3{margin:0 0 4px;font-size:14px;font-weight:900}
  .act p{margin:0;color:var(--muted);font-size:11.8px;min-height:30px}
  .imgrow{display:grid;grid-template-columns:repeat(3,1fr);gap:6px;margin:6px 0}
  .ph{width:100%;height:90px;background:#fff;display:flex;align-items:center;justify-content:center;border-radius:8px}
  .ph img{max-width:100%;max-height:100%;object-fit:contain;border-radius:6px}
  .act .actions{margin-top:auto;display:flex;gap:6px}

  /* Order (right side) */
  aside{display:flex;flex-direction:column}
  .order{background:#fff;border:1px solid #efe4cf;border-radius:14px;display:flex;flex-direction:column}
  .order .head{padding:10px 12px;font-weight:900;border-bottom:1px solid #efe4cf}
  .order .items{padding:8px 12px;display:flex;flex-direction:column;gap:6px;min-height:100px}
  .rowItem{display:flex;align-items:center;justify-content:space-between;padding:6px 8px;background:#fff;border:1px solid #efe3cb;border-radius:10px}
  .rowItem .l{display:flex;gap:6px;align-items:center;flex-wrap:wrap}
  .est{font-size:10.5px;color:#6a5330;background:#fff0d0;border:1px solid #ecd6a4;padding:2px 6px;border-radius:999px;font-weight:800}
  .order .total{padding:8px 12px;font-weight:900;border-top:1px solid #efe4cf;display:flex;justify-content:space-between}
  .order .form{padding:10px 12px;display:grid;gap:6px}

  /* Modals & confirmation */
  .modal{position:fixed;inset:0;background:rgba(9,14,22,.35);backdrop-filter:blur(8px);-webkit-backdrop-filter:blur(8px);display:none;align-items:center;justify-content:center;padding:16px;z-index:50}
  .modal.open{display:flex;animation:fade .18s ease-out}
  @keyframes fade{from{opacity:0}to{opacity:1}}
  .sheet{background:#fff;border:1px solid #eee3cf;border-radius:14px;box-shadow:var(--shadow);max-width:720px;width:100%;max-height:80vh;display:flex;flex-direction:column}
  .sheet .hd{padding:10px 12px;font-weight:900;border-bottom:1px solid #efe4cf}
  .sheet .bd{padding:12px;overflow:auto}
  .sheet .ft{padding:10px 12px;border-top:1px solid #efe4cf;display:flex;gap:8px;justify-content:flex-end}

  .confirm{position:fixed;inset:0;display:none;align-items:center;justify-content:center;background:rgba(5,10,20,.35);backdrop-filter:blur(8px);z-index:60}
  .confirm.show{display:flex}
  .confirm .box{background:#ffffff; border:1px solid #e8edf7; border-radius:16px; padding:20px; box-shadow:0 22px 60px rgba(0,0,0,.18); text-align:center; max-width:460px}
  .confirm .box h3{margin:0 0 6px;font-size:18px}
  .confirm .box p{margin:0;color:#5d6a78}

</style>
</head>
<body>
  <div class="wrap">
    <div class="panel">
      <header>
        <div class="brand">
          <div class="logo-dot"></div>
          <div>
            <h1>Nordic Loft Ålesund — Concierge</h1>
            <div class="tagline">Order add-ons, groceries & experiences (pay later, confirm via message).</div>
          </div>
        </div>
        <div class="links">
          <a class="pill" href="https://docs.google.com/document/d/12GjZr3Lu2dz23FNhq0lyMkD6iD_7Wx3burXyg3A5o2g/edit?tab=t.0#heading=h.erb8cyn8svqx" target="_blank" rel="noopener">Local Guide</a>
          <a class="pill" href="https://docs.google.com/document/d/1438-pOjPXDA6WhvLcfWRjl4x0Id2-jwTWMYlVJ1PoEo/edit?usp=sharing" target="_blank" rel="noopener">Check-in</a>
          <a class="pill" href="https://www.airbnb.no/rooms/1292161045124316301?guests=1&adults=1&s=67&unique_share_id=018ac709-a518-4a2a-8bd2-ea034dd70f1f" target="_blank" rel="noopener">View on Airbnb</a>
        </div>
      </header>

      <div class="grid">
        <!-- LEFT -->
        <div>
          <!-- Groceries -->
          <section class="card">
            <div class="hero"><h2>Grocery & Shopping Service</h2><p>Tap to add. Groceries are <strong>Request Quote</strong> (priced after shopping).</p></div>
            <div class="pad">
              <div class="chips" id="groceryChips">
                <div class="chip" data-id="gro-milk" data-name="Grocery: Milk">Milk<span class="badge">1</span></div>
                <div class="chip" data-id="gro-oat" data-name="Grocery: Oat Milk">Oat Milk<span class="badge">1</span></div>
                <div class="chip" data-id="gro-eggs" data-name="Grocery: Eggs (12)">Eggs (12)<span class="badge">1</span></div>
                <div class="chip" data-id="gro-bread" data-name="Grocery: Fresh Bread">Fresh Bread<span class="badge">1</span></div>
                <div class="chip" data-id="gro-fruit" data-name="Grocery: Seasonal Fruit">Seasonal Fruit<span class="badge">1</span></div>
                <div class="chip" data-id="gro-spark" data-name="Grocery: Sparkling Water (1.5L)">Sparkling Water (1.5L)<span class="badge">1</span></div>
                <div class="chip" data-id="gro-snacks" data-name="Grocery: Snacks & Chocolates">Snacks & Chocolates<span class="badge">1</span></div>
                <div class="chip" data-id="gro-flowers" data-name="Grocery: Flowers">Flowers<span class="badge">1</span></div>
              </div>
              <div style="margin-top:6px;color:var(--muted);font-size:12px">Tap again to remove. You can also add a custom item:</div>
              <div class="custom-row">
                <input id="customGroceryName" type="text" placeholder="e.g., Gluten-free bread (2), Oatly Barista x2">
                <button class="btn gold" id="addCustomGrocery" type="button">Add custom</button>
              </div>
              <textarea id="shoppingText" rows="2" placeholder="Optional: full shopping list / brands / quantities…"></textarea>
            </div>
          </section>

          <!-- Featured Add-Ons -->
          <section class="card" style="margin-top:10px">
            <div class="hero"><h2>Featured Add-Ons</h2><p>These are the products you’ll find in the loft — feel free to purchase what you see.</p></div>
            <div class="pad">
              <div class="products" id="products">
                <!-- 1 Wine -->
                <div class="p" data-id="wine-house-red" data-price="349" data-name="House Red Wine – Malbec (bottle)">
                  <div class="imgWrap"><img src="https://storage.googleapis.com/msgsndr/ZOaFJ8FLtFptFJMy2ZSH/media/68f8d6284ab728e809922cc0.png" alt="Malbec"></div>
                  <div class="meta"><div class="name">House Red Wine – Malbec (bottle)</div><div class="desc">A smooth, food-friendly Malbec.</div></div>
                  <div class="price-add">
                    <div class="price">kr 349</div>
                    <div class="stepper">
                      <button data-step="-1">−</button>
                      <input type="number" value="0" min="0">
                      <button data-step="1">+</button>
                      <button class="btn gold" data-action="add-product">Add</button>
                    </div>
                  </div>
                </div>
                <!-- 2 Glass -->
                <div class="p" data-id="norsk-glass" data-price="299" data-name="Norwegian “Norge” Glass (each)">
                  <div class="imgWrap"><img src="https://storage.googleapis.com/msgsndr/ZOaFJ8FLtFptFJMy2ZSH/media/68f8d5b64ab72867ed9222eb.jpeg" alt="Norge glass"></div>
                  <div class="meta"><div class="name">Norwegian “Norge” Glass (each)</div><div class="desc">Elegant engraved tumbler.</div></div>
                  <div class="price-add">
                    <div class="price">kr 299</div>
                    <div class="stepper">
                      <button data-step="-1">−</button>
                      <input type="number" value="0" min="0">
                      <button data-step="1">+</button>
                      <button class="btn gold" data-action="add-product">Add</button>
                    </div>
                  </div>
                </div>
                <!-- 3 Talking Hearts -->
                <div class="p" data-id="talking-hearts" data-price="299" data-name="Talking Hearts — Couples (200 questions)">
                  <div class="imgWrap"><img src="https://storage.googleapis.com/msgsndr/ZOaFJ8FLtFptFJMy2ZSH/media/68f8d5bcc9994e8e9cc930df.png" alt="Talking Hearts"></div>
                  <div class="meta"><div class="name">Talking Hearts — Couples (200 questions)</div><div class="desc">Deep and playful prompts.</div></div>
                  <div class="price-add">
                    <div class="price">kr 299</div>
                    <div class="stepper">
                      <button data-step="-1">−</button>
                      <input type="number" value="0" min="0">
                      <button data-step="1">+</button>
                      <button class="btn gold" data-action="add-product">Add</button>
                    </div>
                  </div>
                </div>
                <!-- 4 Know Me 50 -->
                <div class="p" data-id="know-me-50" data-price="199" data-name="How Well Do You Know Me? (50 questions)">
                  <div class="imgWrap"><img src="https://storage.googleapis.com/msgsndr/ZOaFJ8FLtFptFJMy2ZSH/media/68f8d5bd865897e50df7adca.png" alt="Know Me"></div>
                  <div class="meta"><div class="name">How Well Do You Know Me? (50 questions)</div><div class="desc">Quick after-dinner game.</div></div>
                  <div class="price-add">
                    <div class="price">kr 199</div>
                    <div class="stepper">
                      <button data-step="-1">−</button>
                      <input type="number" value="0" min="0">
                      <button data-step="1">+</button>
                      <button class="btn gold" data-action="add-product">Add</button>
                    </div>
                  </div>
                </div>
                <!-- 5 Questions for Humans -->
                <div class="p" data-id="qfh" data-price="249" data-name="Questions for Humans — Couples">
                  <div class="imgWrap"><img src="https://storage.googleapis.com/msgsndr/ZOaFJ8FLtFptFJMy2ZSH/media/68f8d5bc691ecd36e165f07a.png" alt="Questions for Humans"></div>
                  <div class="meta"><div class="name">Questions for Humans — Couples</div><div class="desc">Light, funny prompts.</div></div>
                  <div class="price-add">
                    <div class="price">kr 249</div>
                    <div class="stepper">
                      <button data-step="-1">−</button>
                      <input type="number" value="0" min="0">
                      <button data-step="1">+</button>
                      <button class="btn gold" data-action="add-product">Add</button>
                    </div>
                  </div>
                </div>
                <!-- 6 Date Night -->
                <div class="p" data-id="date-night" data-price="349" data-name="Date Night Adventure — 40 Scratch-Offs">
                  <div class="imgWrap"><img src="https://storage.googleapis.com/msgsndr/ZOaFJ8FLtFptFJMy2ZSH/media/68f8d5bc691ecd7d2f65f079.png" alt="Date Night Adventure"></div>
                  <div class="meta"><div class="name">Date Night Adventure — 40 Scratch-Offs</div><div class="desc">Scratch, reveal, and go!</div></div>
                  <div class="price-add">
                    <div class="price">kr 349</div>
                    <div class="stepper">
                      <button data-step="-1">−</button>
                      <input type="number" value="0" min="0">
                      <button data-step="1">+</button>
                      <button class="btn gold" data-action="add-product">Add</button>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </section>

          <!-- Activities -->
          <section class="card" style="margin-top:10px">
            <div class="hero"><h2>Activities & Arrangements</h2><p>Tap “Learn more”, then “Add” to request — we’ll confirm availability & pricing.</p></div>
            <div class="pad">
              <div class="actgrid" id="activityGrid">
                <!-- VIP Photo Shoot with Ira -->
                <div class="act" data-id="act-ira" data-name="VIP Photo Shoot with Ira">
                  <h3>VIP Photo Shoot with Ira</h3>
                  <p>Private photo experience with <strong>Ira</strong>, a talented Ukrainian photographer with warm, cinematic style.</p>
                  <div class="imgrow">
                    <div class="ph"><img src="https://storage.googleapis.com/msgsndr/ZOaFJ8FLtFptFJMy2ZSH/media/68f9011302a7ea2ed2ffc83f.jpeg" alt=""></div>
                    <div class="ph"><img src="https://storage.googleapis.com/msgsndr/ZOaFJ8FLtFptFJMy2ZSH/media/68f901134ab728b08f9a0a93.jpeg" alt=""></div>
                    <div class="ph"><img src="https://storage.googleapis.com/msgsndr/ZOaFJ8FLtFptFJMy2ZSH/media/68f9011342c58c012d355c2b.jpeg" alt=""></div>
                  </div>
                  <div class="actions">
                    <button class="btn" data-learn="ira">Learn more</button>
                    <button class="btn gold" data-action="add-activity">Add</button>
                  </div>
                </div>
                <!-- Fishing with Simon -->
                <div class="act" data-id="act-simon" data-name="Fishing with Simon (local fisher)">
                  <h3>Fishing with Simon (local fisher)</h3>
                  <p>Go with <strong>Simon</strong> for authentic fjord fishing. Spot seals, explore islands, get dropped at secret places, take home prepared fish.</p>
                  <div class="imgrow">
                    <div class="ph"><img src="https://storage.googleapis.com/msgsndr/ZOaFJ8FLtFptFJMy2ZSH/media/68f8ff2bad50b295805908f2.jpeg" alt=""></div>
                    <div class="ph"><img src="https://storage.googleapis.com/msgsndr/ZOaFJ8FLtFptFJMy2ZSH/media/68f8ff2b691ecdb41b6d0430.jpeg" alt=""></div>
                    <div class="ph"><img src="https://storage.googleapis.com/msgsndr/ZOaFJ8FLtFptFJMy2ZSH/media/68f8ff2b5da419257a2f5a5c.jpeg" alt=""></div>
                  </div>
                  <div class="actions">
                    <button class="btn" data-learn="simon">Learn more</button>
                    <button class="btn gold" data-action="add-activity">Add</button>
                  </div>
                </div>
              </div>

              <div class="pad" style="padding:6px 0 0">
                <label>Special notes or timing</label>
                <textarea id="activityText" rows="2" placeholder="Preferred time, pickup, celebration, etc."></textarea>
              </div>
            </div>
          </section>

          <div class="pad" style="text-align:center;color:#5f676f;font-size:11.5px;font-weight:700;">Payments arranged after confirmation.</div>
        </div>

        <!-- RIGHT -->
        <aside>
          <div class="order">
            <div class="head">Your Order</div>
            <div id="cartItems" class="items"></div>
            <div id="emptyNote" class="pad" style="color:var(--muted);font-size:12px">Selected items will appear here.</div>
            <div class="total"><span>Total</span><span id="grand">kr 0</span></div>
            <div class="form">
              <input id="guestName" type="text" placeholder="Your name">
              <input id="email" type="email" placeholder="Email">
              <input id="phone" type="tel" placeholder="Phone / WhatsApp">
              <input id="arrivalDate" type="date" placeholder="Arrival date">
              <input id="room" type="text" value="Nordic Loft Ålesund" placeholder="Apartment">
              <textarea id="notes" rows="2" placeholder="Delivery timing, allergies, anything else…"></textarea>
              <button id="openSummary" class="btn primary">Review & Place Order</button>
            </div>
          </div>
        </aside>
      </div>
    </div>
  </div>

  <!-- Summary Modal -->
  <div id="summaryModal" class="modal" aria-hidden="true">
    <div class="sheet">
      <div class="hd">Review your order</div>
      <div class="bd">
        <div id="summaryList" style="display:grid;gap:8px"></div>
        <hr style="border:0;border-top:1px solid #eee3cf;margin:10px 0">
        <div style="display:flex;justify-content:space-between;font-weight:900"><span>Total (priced items)</span><span id="summaryTotal">kr 0</span></div>
        <div style="margin-top:6px;color:#6f7681">
          <div><strong>Grocery notes:</strong> <span id="sumShop">—</span></div>
          <div><strong>Activity notes:</strong> <span id="sumAct">—</span></div>
        </div>
        <div style="margin-top:6px;color:#6f7681">
          <div><strong>Name:</strong> <span id="sumName">—</span></div>
          <div><strong>Email:</strong> <span id="sumEmail">—</span></div>
          <div><strong>Phone:</strong> <span id="sumPhone">—</span></div>
          <div><strong>Arrival:</strong> <span id="sumArrival">—</span></div>
        </div>
      </div>
      <div class="ft">
        <button id="closeSummary" class="btn">Keep Editing</button>
        <button id="confirmSend" class="btn gold">Confirm & Send</button>
      </div>
    </div>
  </div>

  <!-- Learn More Modal -->
  <div id="learnModal" class="modal" aria-hidden="true">
    <div class="sheet">
      <div class="hd" id="learnTitle">Experience</div>
      <div class="bd" id="learnBody"></div>
      <div class="ft"><button class="btn" onclick="toggleLearn(false)">Close</button></div>
    </div>
  </div>

  <!-- Confirmation Overlay -->
  <div id="confirmOverlay" class="confirm" aria-hidden="true">
    <div class="box">
      <h3>✅ Order sent!</h3>
      <p>We’ve received your request. We’ll confirm availability and payment shortly.</p>
      <div style="margin-top:12px">
        <button class="btn primary" onclick="closeConfirm()">Close</button>
      </div>
    </div>
  </div>

<script>
  /* ------- Config ------- */
  const webhookURL = "https://services.leadconnectorhq.com/hooks/ZOaFJ8FLtFptFJMy2ZSH/webhook-trigger/f540af18-28fb-4fdc-82cc-1a3a114d4142";
  const money = n => "kr " + n;

  /* ------- Cart state ------- */
  const cart = new Map();
  const cartItems = document.getElementById("cartItems");
  const emptyNote = document.getElementById("emptyNote");
  const grandEl = document.getElementById("grand");
  function addLine({id,name,qty=1,unit_price=0,estimate=false}){
    const it = cart.get(id) || {id,name,qty:0,unit_price,estimate};
    it.qty += qty; it.name=name; it.unit_price=unit_price; it.estimate=estimate;
    if(it.qty<=0) cart.delete(id); else cart.set(id,it);
    renderCart();
  }
  function setLine({id,name,qty,unit_price=0,estimate=false}){
    if(qty<=0){cart.delete(id); renderCart(); return;}
    cart.set(id,{id,name,qty,unit_price,estimate}); renderCart();
  }
  function renderCart(){
    cartItems.innerHTML=""; let total=0;
    cart.forEach(i=>{
      const sub = i.estimate ? 0 : i.qty*(i.unit_price||0);
      total += sub;
      const row = document.createElement("div"); row.className="rowItem";
      row.innerHTML = `
        <div class="l">
          <div style="font-weight:800">${i.name}</div>
          ${i.estimate ? "<span class=\"est\">Request&nbsp;Quote</span>" : ""}
          <div style="font-size:12px;color:#6f7681">x${i.qty}${i.unit_price? " · kr "+i.unit_price:""}</div>
        </div>
        <div style="font-weight:900">${i.estimate? "-": money(sub)}</div>`;
      cartItems.appendChild(row);
    });
    grandEl.textContent = money(total);
    emptyNote.style.display = cart.size ? "none":"block";
  }

  /* ------- Groceries ------- */
  document.querySelectorAll(".chip").forEach(ch=>{
    ch.classList.remove("active");
    ch.addEventListener("click",()=>{
      const id=ch.dataset.id, name=ch.dataset.name;
      if(ch.classList.contains("active")){
        setLine({id,name,qty:0,estimate:true});
        ch.classList.remove("active");
      }else{
        setLine({id,name,qty:1,estimate:true});
        ch.classList.add("active");
      }
    })
  });
  document.getElementById("addCustomGrocery").addEventListener("click",()=>{
    const name=(document.getElementById("customGroceryName").value||"").trim();
    if(!name) return;
    addLine({id:"gro-custom-"+Date.now(),name:"Grocery: "+name,qty:1,estimate:true});
    document.getElementById("customGroceryName").value="";
  });

  /* ------- Add-ons (products) ------- */
  document.getElementById("products").addEventListener("click",(e)=>{
    const card = e.target.closest(".p"); if(!card) return;
    const stepBtn = e.target.closest("[data-step]");
    if(stepBtn){
      const step = parseInt(stepBtn.getAttribute("data-step"),10);
      const inp = card.querySelector("input[type=number]");
      const v = Math.max(0, parseInt(inp.value||"0",10)+step);
      inp.value = v; return;
    }
    if(e.target.dataset.action==="add-product"){
      const qty = Math.max(0, parseInt(card.querySelector("input[type=number]").value||"0",10));
      if(qty===0) return;
      addLine({ id:card.dataset.id, name:card.dataset.name, qty, unit_price:parseInt(card.dataset.price,10), estimate:false });
      card.classList.add("added");
      card.querySelector("input[type=number]").value = 0;
      setTimeout(()=>card.classList.remove("added"),900);
    }
  });

  /* ------- Activities + Learn more ------- */
  const learnModal=document.getElementById("learnModal");
  function toggleLearn(open){ learnModal.classList.toggle("open", !!open); learnModal.setAttribute("aria-hidden", open? "false":"true"); }
  window.toggleLearn=toggleLearn;

  document.getElementById("activityGrid").addEventListener("click",(e)=>{
    const addBtn=e.target.closest("[data-action=add-activity]");
    if(addBtn){
      const box=addBtn.closest(".act");
      addLine({id:box.dataset.id+"-"+Date.now(),name:box.dataset.name,qty:1,estimate:true});
      box.style.boxShadow="0 0 0 6px rgba(94,155,231,.28)"; setTimeout(()=>box.style.boxShadow="",900);
      return;
    }
    const learnBtn=e.target.closest("[data-learn]");
    if(learnBtn){
      const type=learnBtn.getAttribute("data-learn");
      const title= type==="ira" ? "VIP Photo Shoot with Ira" : "Fishing with Simon";
      const body= type==="ira"
       ? `<p style="margin:0 0 8px;color:#6f7681">A private, cinematic photo session with <strong>Ira</strong> around Ålesund. Guidance, warm natural light and editorial framing.</p>
          <div style="display:grid;grid-template-columns:repeat(3,1fr);gap:8px">
            <img style="width:100%;height:120px;object-fit:contain;background:#fff;border-radius:10px" src="https://storage.googleapis.com/msgsndr/ZOaFJ8FLtFptFJMy2ZSH/media/68f9011302a7ea2ed2ffc83f.jpeg">
            <img style="width:100%;height:120px;object-fit:contain;background:#fff;border-radius:10px" src="https://storage.googleapis.com/msgsndr/ZOaFJ8FLtFptFJMy2ZSH/media/68f901134ab728b08f9a0a93.jpeg">
            <img style="width:100%;height:120px;object-fit:contain;background:#fff;border-radius:10px" src="https://storage.googleapis.com/msgsndr/ZOaFJ8FLtFptFJMy2ZSH/media/68f9011342c58c012d355c2b.jpeg">
          </div>`
       : `<p style="margin:0 0 8px;color:#6f7681">Head out with <strong>Simon</strong> for authentic fjord fishing. Explore coves, maybe spot seals, and take home prepared fish.</p>
          <div style="display:grid;grid-template-columns:repeat(3,1fr);gap:8px">
            <img style="width:100%;height:120px;object-fit:contain;background:#fff;border-radius:10px" src="https://storage.googleapis.com/msgsndr/ZOaFJ8FLtFptFJMy2ZSH/media/68f8ff2bad50b295805908f2.jpeg">
            <img style="width:100%;height:120px;object-fit:contain;background:#fff;border-radius:10px" src="https://storage.googleapis.com/msgsndr/ZOaFJ8FLtFptFJMy2ZSH/media/68f8ff2b691ecdb41b6d0430.jpeg">
            <img style="width:100%;height:120px;object-fit:contain;background:#fff;border-radius:10px" src="https://storage.googleapis.com/msgsndr/ZOaFJ8FLtFptFJMy2ZSH/media/68f8ff2b5da419257a2f5a5c.jpeg">
          </div>`;
      document.getElementById("learnTitle").textContent=title;
      document.getElementById("learnBody").innerHTML=body;
      toggleLearn(true);
    }
  });

  /* ------- Summary modal + submit ------- */
  const summaryModal=document.getElementById("summaryModal");
  function toggleSummary(open){ summaryModal.classList.toggle("open", !!open); summaryModal.setAttribute("aria-hidden", open? "false":"true"); }
  document.getElementById("openSummary").addEventListener("click",()=>{
    const list=document.getElementById("summaryList"); list.innerHTML=""; let total=0;
    cart.forEach(i=>{
      const sub=i.estimate? "-" : money(i.qty*(i.unit_price||0));
      if(!i.estimate) total+=i.qty*(i.unit_price||0);
      const row=document.createElement("div"); row.style.display="flex"; row.style.justifyContent="space-between";
      row.innerHTML=`<div><strong>${i.name}</strong><div style="color:#6f7681">x${i.qty}${i.unit_price? " · kr "+i.unit_price:""}</div></div><div style="font-weight:900">${i.estimate? "<span class='est'>Request&nbsp;Quote</span>":sub}</div>`;
      list.appendChild(row);
    });
    document.getElementById("summaryTotal").textContent=money(total);
    document.getElementById("sumShop").textContent=document.getElementById("shoppingText").value||"—";
    document.getElementById("sumAct").textContent=document.getElementById("activityText").value||"—";
    document.getElementById("sumName").textContent=document.getElementById("guestName").value||"—";
    document.getElementById("sumEmail").textContent=document.getElementById("email").value||"—";
    document.getElementById("sumPhone").textContent=document.getElementById("phone").value||"—";
    document.getElementById("sumArrival").textContent=document.getElementById("arrivalDate").value||"—";
    toggleSummary(true);
  });
  document.getElementById("closeSummary").addEventListener("click",()=>toggleSummary(false));

  function openConfirm(){ const c=document.getElementById("confirmOverlay"); c.classList.add("show"); c.setAttribute("aria-hidden","false"); }
  function closeConfirm(){ const c=document.getElementById("confirmOverlay"); c.classList.remove("show"); c.setAttribute("aria-hidden","true"); }
  window.closeConfirm = closeConfirm;

  document.getElementById("confirmSend").addEventListener("click", async ()=>{
    const payload = {
      apartment: document.getElementById("room").value || "Nordic Loft Ålesund",
      guest_name: document.getElementById("guestName").value,
      email: document.getElementById("email").value,
      phone: document.getElementById("phone").value,
      arrival_date: document.getElementById("arrivalDate").value,
      notes: document.getElementById("notes").value,
      concierge: { shopping: document.getElementById("shoppingText").value, activities: document.getElementById("activityText").value },
      items: Array.from(cart.values()).map(i=>({ id:i.id, name:i.name, qty:i.qty, unit_price:i.unit_price||0, subtotal:(i.unit_price||0)*i.qty, estimate:!!i.estimate })),
      currency:"NOK",
      total: Array.from(cart.values()).reduce((s,i)=> s + (i.estimate?0:(i.unit_price||0)*i.qty), 0),
      created_at: new Date().toISOString()
    };

    try{
      const res = await fetch(webhookURL,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(payload)});
      if(!res.ok) throw new Error("Network");
      toggleSummary(false);
      // Reset & show confirmation overlay
      cart.clear(); renderCart();
      document.querySelectorAll(".chip.active").forEach(c=>c.classList.remove("active"));
      document.getElementById("shoppingText").value="";
      document.getElementById("activityText").value="";
      openConfirm();
    }catch(e){
      alert("Could not submit right now. Please try again later.");
      console.error(e);
    }
  });

  renderCart();
</script>
</body>
</html>
